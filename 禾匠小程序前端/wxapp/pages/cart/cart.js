var api=require("../../api.js"),app=getApp();Page({data:{total_price:0,cart_check_all:!1,cart_list:[]},onLoad:function(t){app.pageOnLoad(this)},onReady:function(){},onShow:function(){app.pageOnShow(this);this.setData({cart_check_all:!1,show_cart_edit:!1}),this.getCartList()},getCartList:function(){var a=this;a.setData({show_no_data_tip:!1}),app.request({url:api.cart.list,success:function(t){0==t.code&&a.setData({cart_list:t.data.list,total_price:0,cart_check_all:!1,show_cart_edit:!1}),a.setData({show_no_data_tip:0==a.data.cart_list.length})}})},cartLess:function(t){var a=this,c=a.data.cart_list;for(var i in c)t.currentTarget.id==c[i].cart_id&&(c[i].num=a.data.cart_list[i].num-1,c[i].price=a.data.cart_list[i].unitPrice*c[i].num,a.setData({cart_list:c}),a.updateTotalPrice())},cartAdd:function(t){var a=this,c=a.data.cart_list;for(var i in c)t.currentTarget.id==c[i].cart_id&&(c[i].num=a.data.cart_list[i].num+1,c[i].price=a.data.cart_list[i].unitPrice*c[i].num,a.setData({cart_list:c}),a.updateTotalPrice())},cartCheck:function(t){var a=this,c=t.currentTarget.dataset.index,i=a.data.cart_list,e=0;for(var r in i[c].checked?i[c].checked=!1:i[c].checked=!0,i)1==i[r].checked&&e++;a.setData({cart_list:i}),e==i.length?a.setData({cart_check_all:!0}):a.setData({cart_check_all:!1}),a.updateTotalPrice()},cartCheckAll:function(){var t=this,a=t.data.cart_list,c=!1;for(var i in c=!t.data.cart_check_all,a)a[i].disabled&&!t.data.show_cart_edit||(a[i].checked=c);t.setData({cart_check_all:c,cart_list:a}),t.updateTotalPrice()},updateTotalPrice:function(){var t=0,a=this.data.cart_list;for(var c in a)a[c].checked&&(t+=a[c].price);this.setData({total_price:t.toFixed(2)})},cartSubmit:function(){var e=this,t=JSON.stringify(e.data.cart_list);t!=[]&&app.request({url:api.cart.cart_edit,method:"post",data:{list:t},success:function(t){if(0==t.code){var a=e.data.cart_list,c=[];for(var i in a)a[i].checked&&c.push(a[i].cart_id);if(0==c.length)return!0;wx.navigateTo({url:"/pages/order-submit/order-submit?cart_id_list="+JSON.stringify(c)})}}})},cartEdit:function(){var t=this,a=t.data.cart_list;for(var c in a)a[c].checked=!1;t.setData({cart_list:a,show_cart_edit:!0,cart_check_all:!1}),t.updateTotalPrice()},cartDone:function(){var t=this,a=t.data.cart_list;for(var c in a)a[c].checked=!1;t.setData({cart_list:a,show_cart_edit:!1,cart_check_all:!1}),t.updateTotalPrice()},cartDelete:function(){var a=this,t=a.data.cart_list,c=[];for(var i in t)t[i].checked&&c.push(t[i].cart_id);if(0==c.length)return!0;wx.showModal({title:"提示",content:"确认删除"+c.length+"项内容？",success:function(t){if(t.cancel)return!0;wx.showLoading({title:"正在删除",mask:!0}),app.request({url:api.cart.delete,data:{cart_id_list:JSON.stringify(c)},success:function(t){wx.hideLoading(),wx.showToast({title:t.msg}),0==t.code&&a.getCartList(),t.code}})}})},onHide:function(){var t=JSON.stringify(this.data.cart_list);t!=[]&&app.request({url:api.cart.cart_edit,method:"post",data:{list:t},success:function(t){0==t.code&&console.log(t.msg)}})},onUnload:function(){var t=JSON.stringify(this.data.cart_list);t!=[]&&app.request({url:api.cart.cart_edit,method:"post",data:{list:t},success:function(t){0==t.code&&console.log(t.msg)}})}}); 
 			