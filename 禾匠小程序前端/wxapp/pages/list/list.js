var api=require("../../api.js"),app=getApp(),is_loading_more=!1,is_no_more=!1;Page({data:{cat_id:"",page:1,cat_list:[],goods_list:[],sort:0,sort_type:-1},onLoad:function(t){app.pageOnLoad(this),this.loadData(t)},loadData:function(t){var a=wx.getStorageSync("cat_list"),e="";if(t.cat_id)for(var i in a){var s=!1;for(var o in a[i].id==t.cat_id&&(a[i].checked=!0,0<a[i].list.length&&(e="height-bar")),a[i].list)a[i].list[o].id==t.cat_id&&(s=a[i].list[o].checked=!0,e="height-bar");s&&(a[i].checked=!0)}this.setData({cat_list:a,cat_id:t.cat_id||"",height_bar:e}),this.reloadGoodsList()},catClick:function(t){var a=this,e="",i=t.currentTarget.dataset.index,s=a.data.cat_list;for(var o in s){for(var r in s[o].list)s[o].list[r].checked=!1;o==i?(s[o].checked=!0,e=s[o].id):s[o].checked=!1}var d="";0<s[i].list.length&&(d="height-bar"),a.setData({cat_list:s,cat_id:e,height_bar:d}),a.reloadGoodsList()},subCatClick:function(t){var a=this,e="",i=t.currentTarget.dataset.index,s=t.currentTarget.dataset.parentIndex,o=a.data.cat_list;for(var r in o)for(var d in o[r].list)r==s&&d==i?(o[r].list[d].checked=!0,e=o[r].list[d].id):o[r].list[d].checked=!1;a.setData({cat_list:o,cat_id:e}),a.reloadGoodsList()},allClick:function(){var t=this,a=t.data.cat_list;for(var e in a){for(var i in a[e].list)a[e].list[i].checked=!1;a[e].checked=!1}t.setData({cat_list:a,cat_id:"",height_bar:""}),t.reloadGoodsList()},reloadGoodsList:function(){var a=this;is_no_more=!1,a.setData({page:1,goods_list:[],show_no_data_tip:!1});var t=a.data.cat_id||"",e=a.data.page||1;app.request({url:api.default.goods_list,data:{cat_id:t,page:e,sort:a.data.sort,sort_type:a.data.sort_type},success:function(t){0==t.code&&(0==t.data.list.length&&(is_no_more=!0),a.setData({page:e+1}),a.setData({goods_list:t.data.list})),a.setData({show_no_data_tip:0==a.data.goods_list.length})},complete:function(){}})},loadMoreGoodsList:function(){var e=this;if(!is_loading_more){e.setData({show_loading_bar:!0}),is_loading_more=!0;var t=e.data.cat_id||"",i=e.data.page||2;app.request({url:api.default.goods_list,data:{page:i,cat_id:t,sort:e.data.sort,sort_type:e.data.sort_type},success:function(t){0==t.data.list.length&&(is_no_more=!0);var a=e.data.goods_list.concat(t.data.list);e.setData({goods_list:a,page:i+1})},complete:function(){is_loading_more=!1,e.setData({show_loading_bar:!1})}})}},onReachBottom:function(){is_no_more||this.loadMoreGoodsList()},onShow:function(t){app.pageOnShow(this);var a=this;if(wx.getStorageSync("list_page_reload")){var e=wx.getStorageSync("list_page_options");wx.removeStorageSync("list_page_options"),wx.removeStorageSync("list_page_reload");var i=e.cat_id||"";a.setData({cat_id:i});var s=a.data.cat_list;for(var o in s){var r=!1;for(var d in s[o].list)s[o].list[d].id==i?r=s[o].list[d].checked=!0:s[o].list[d].checked=!1;r||i==s[o].id?(s[o].checked=!0,s[o].list&&0<s[o].list.length&&a.setData({height_bar:"height-bar"})):s[o].checked=!1}a.setData({cat_list:s}),a.reloadGoodsList()}},sortClick:function(t){var a=this,e=t.currentTarget.dataset.sort,i=null==t.currentTarget.dataset.default_sort_type?-1:t.currentTarget.dataset.default_sort_type,s=a.data.sort_type;if(a.data.sort==e){if(-1==i)return;s=-1==a.data.sort_type?i:0==s?1:0}else s=i;a.setData({sort:e,sort_type:s}),a.reloadGoodsList()},onReady:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){}}); 
 			